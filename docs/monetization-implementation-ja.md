# 収益化 実装仕様（日本語）

## 1. プラン定義（確定版）

### Free（無料）
- 広告あり
- 報酬広告を1回視聴で「24時間広告なし」

### 広告オフ
- 月額: 100円
- 年額: 900円
- 機能追加なし（広告のみ非表示）

### Pro
- 月額: 500円
- 年額: 4500円
- 広告なし（広告オフを内包）
- Pro機能利用可

## 2. SKU（Product ID）案

- `jp.mockmaker.adfree.monthly`
- `jp.mockmaker.adfree.yearly`
- `jp.mockmaker.pro.monthly`
- `jp.mockmaker.pro.yearly`

補足:
- `Pro` 購入中は `広告オフ` の購入ボタンを無効化
- すでに `広告オフ` 契約中でも `Pro` 購入は可能（アップグレード案内を表示）

## 3. 課金画面 文言（そのまま使用可）

### 画面タイトル
- `プランを選択`

### サブタイトル
- `学習は無料で続けられます。必要なときだけアップグレードできます。`

### 無料カード
- タイトル: `無料プラン`
- 説明: `基本機能はすべて無料`
- 箇条書き:
  - `問題作成・模試作成・暗記・印刷`
  - `広告あり`
  - `広告を1回視聴すると24時間広告なし`
- ボタン: `このまま使う`

### 広告オフカード
- タイトル: `広告オフ`
- 説明: `機能はそのまま、広告だけオフ`
- 価格:
  - `月額 100円`
  - `年額 900円（25%お得）`
- 箇条書き:
  - `広告非表示`
  - `機能追加なし`
- ボタン:
  - `月額で広告オフ`
  - `年額で広告オフ`

### Proカード
- タイトル: `Pro`
- 説明: `広告なし + 高度機能`
- 価格:
  - `月額 500円`
  - `年額 4500円（25%お得）`
- 箇条書き:
  - `広告非表示（広告オフを含む）`
  - `高度分析`
  - `共有強化`
  - `高度印刷`
- ボタン:
  - `月額Proを開始`
  - `年額Proを開始`

### 補助文言
- `いつでもキャンセルできます。`
- `料金はApple IDに請求されます。`
- `購入の復元`

## 4. 画面ロジック（状態別）

### 未契約
- Free/広告オフ/Proを表示
- 報酬広告ボタンを表示

### 報酬広告有効中（24h）
- `広告なし（残り xx時間）` を表示
- 広告オフ/Proは通常表示

### 広告オフ契約中
- 広告オフカードに `利用中`
- 報酬広告ボタンは非表示
- Proは購入可能（`Proへアップグレード` 表示）

### Pro契約中
- Proカードに `利用中`
- 広告オフカードは `Proに含まれています`
- 報酬広告ボタンは非表示

## 5. 比較表（UI表示用）

| 項目 | 無料 | 広告オフ | Pro |
|---|---|---|---|
| 問題作成・模試・暗記・印刷 | ○ | ○ | ○ |
| 広告表示 | あり | なし | なし |
| 報酬広告で24時間広告なし | ○ | - | - |
| 高度分析 | - | - | ○ |
| 共有強化 | - | - | ○ |
| 高度印刷 | - | - | ○ |

## 6. データ構造（実装向け）

```json
{
  "plans": {
    "free": { "id": "free" },
    "adfree_monthly": {
      "id": "jp.mockmaker.adfree.monthly",
      "group": "adfree",
      "priceYen": 100,
      "period": "P1M"
    },
    "adfree_yearly": {
      "id": "jp.mockmaker.adfree.yearly",
      "group": "adfree",
      "priceYen": 900,
      "period": "P1Y"
    },
    "pro_monthly": {
      "id": "jp.mockmaker.pro.monthly",
      "group": "pro",
      "priceYen": 500,
      "period": "P1M",
      "includesAdFree": true
    },
    "pro_yearly": {
      "id": "jp.mockmaker.pro.yearly",
      "group": "pro",
      "priceYen": 4500,
      "period": "P1Y",
      "includesAdFree": true
    }
  },
  "rewardedAd": {
    "adFreeHours": 24
  }
}
```

## 7. 判定ロジック（優先順位）

1. `Pro有効` -> 広告なし + Pro機能ON
2. `広告オフ有効` -> 広告なし + Pro機能OFF
3. `rewardedAdUntil > now` -> 広告なし + Pro機能OFF
4. それ以外 -> 広告あり + Pro機能OFF

## 8. 実装チェックリスト

- [ ] 購入状態の取得（起動時/復帰時）
- [ ] 購入/復元ボタン
- [ ] 契約状態による表示切替
- [ ] 報酬広告の24h反映（時刻保存）
- [ ] Proが広告オフを内包するガード
- [ ] 期限切れ時の自動ダウングレード
- [ ] エラー文言（購入失敗/復元失敗/通信失敗）

## 9. エラー文言（そのまま使用可）

- `購入に失敗しました。通信状況を確認して再試行してください。`
- `購入情報を取得できませんでした。しばらくしてから再試行してください。`
- `復元に失敗しました。Apple IDの状態を確認してください。`
- `この機能はProプランで利用できます。`

